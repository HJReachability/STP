% !TEX root = SPP2.tex
\section{Disturbances and Incomplete Information \label{sec:obs_gen}}
Disturbances and incomplete information significantly complicates the SPP scheme. The main differences are as follows:

\begin{enumerate}
\item The dynamics of the vehicles satisfy \eqref{eq:dyn} as opposed to \eqref{eq:dyn_no_dstb}.
\item Committing to exact trajectories is no longer possible, since the disturbance $d_i(\cdot)$ is a priori unknown.
\item The induced obstacles $\ioset_i^j(t)$ are no longer just the danger zones centered around positions.
\end{enumerate}

We present three methods for address the above issues. Each method has its advantages and disadvantages depending on the situation. The three methods are as follows:
\begin{itemize}
\item Centralized control: A specific control strategy is enforced upon a vehicle; this can be achieved, for example, by some central agent such as an air traffic controller.
\item Least restrictive control: A lower-priority vehicle assumes that higher-priority vehicles will arrive at their targets on time, but has no other information.
\item Robust trajectory tracking: Each vehicle declares a nominal trajectory which can be robustly tracked under disturbances.
\end{itemize}

In general, the above methods can be used in combination in a single path planning problem, with each vehicle independently having different assumptions about each higher-priority vehicle. For clarity though, we will present each method as if all vehicles are using the same method of path planning.

In addition, for simplicity and clarity of explanation, we will assume that no static obstacles exist. In the situations where static obstacles do exist, the time-varying obstacles $\obsset_i(t)$ simply becomes the union of the induced obstacles $\ioset_i^j(t)$ in \eqref{eq:ioset} and the static obstacles.

\subsection{Method 1: Centralized Controller \label{sec:cc}}
Since we have assumed no static obstacles exist, the vehicle with the highest priority $\veh_1$ first plans its path by computing the BRS

\begin{equation}
\begin{aligned}
\brs_1^{CC}(t) = \{x_1: &\exists u_1(\cdot) \in \cfset, \forall d_1(\cdot) \in \dfset, x_1(\cdot) \text{ satisfies \eqref{eq:dyn}}, \\
&\exists s \in [\edt_i, \sta_i], x_1(s) \in \targetset_1\}
\end{aligned}
\end{equation}

This BRS can be computed by solving the HJ VI \eqref{eq:HJIVI} with $i=1$:

\begin{equation}
H_i\left(t, x_i, p\right) = \min_{u_i \in \cset} \max_{d_i \in \dset} p \cdot f_i(t, x_i, u_i, d_i)
\end{equation}

\noindent where $l_i(x_i), g_i(t,x_i),V_i(t,x_i)$ are implicit surface functions representing the target $\targetset_i, \obsset_i(t), \brs_i(t)$, respectively. From the BRS, we can obtain the optimal control

\begin{equation}
u_i^*(t,x_i) =  \arg \min_{u_i \in \cset} \max_{d_i \in \dset} p \cdot f_i(t, x_i, u_i, d^*_i)
\end{equation}

The latest departure time $\ldt$ is then given by $\arg \inf_t x_i(\edt) \in \brs_i(t)$.

If there is a centralized controller directly controlling each of the $N$ vehicles, then the control law of each vehicle can be enforced. In this case, lower priority vehicles can safely assume that higher priority vehicles are applying the enforced control law. In particular, the optimal controller for getting to the target, $u^*_i(t, x)$ can be enforced. In this case, the dynamics of each vehicle becomes 

\begin{equation}
\label{eq:dyn_cc}
\begin{aligned}
\dot x_i &= f^*_i (t, x_i, d_i) = f_i(t, x_i, u^*_i(t,x), d_i), t \in [\ldt_i, \sta_i] \\
d_i &\in \dset_i \\
i &= 1,\ldots, N
\end{aligned}
\end{equation}

\noindent where the control no longer appears explicitly in the dynamics.

From the perspective of a lower priority vehicle $\veh_i$, a higher priority vehicle $\veh_j, j < i$ induces an time-varying obstacle that represents the positions that could possibly be within the capture radius $\cradius$ of $\veh_j$ under the dynamics $f^*_j(t, x_j, d_j)$. Determining this obstacle involves first solving a forward reachability problem, whose solution gives us the forward reachable set (FRS) of $\veh_j$ starting from its initial state $x_j(\ldt)$ at initial time $\ldt$, denoted $\frs_j(t)$ and defined as follows:

\begin{equation}
\label{eq:frs}
\begin{aligned}
\frs_j(t) &= \{y \in \R^{n_j}: \exists d_j(\cdot) \in \dfset_j, \\
&x_j(\cdot) \text{ satisfies \eqref{eq:dyn_cc}, }x_j(t) = y\}
\end{aligned}
\end{equation}

Conveniently, the FRS can be computed using the following HJ VI:

\begin{equation}
\label{eq:FRS_j}
\begin{aligned}
&D_t W_j(t, x_j) + H_j\left(t, x_j, D_{x_j} W\right) = 0, t \in [\ldt_j, \sta_j]\\
&W_j(\ldt_j, x_j) = \bar l_j(x_j) \\
&H_j\left(t, x_j, p\right) = \min_{d_j \in \dset_j} p \cdot \bar f_j(t, x_j, d_j)
\end{aligned}
\end{equation}

\noindent where $\bar l$ is chosen to be such that $\bar l (x_j) = 0 \Leftrightarrow x_j = x_j(\ldt)$. To impose that the optimal control is used, we substitute $u_j = u_j^*(t, x_j)$ into \eqref{eq:FRS_j} instead of minimizing over $u_j$. \SBnote{write HJVI with the optimal control plugged in}

The FRS $\frs_j(t)$ represents the set of possible states at time $t$ of a higher-priority vehicle $\veh_j$ given the worst case disturbance $d_j(\cdot)$ and given that $\veh_j$ uses the feedback controller $u_j^*(t, x)$. In order for a lower-priority vehicle $\veh_i$ to guarantee that it does not go within a distance of $\cradius$ to $\veh_j$, $\veh_i$ must stay a distance of at least $\cradius$ away from the set $\frs_j(t)$ for all possible values of the non-position states $\npos_j$. This gives the obstacle induced by a higher priority vehicle $\veh_j$ for a lower priority vehicle $\veh_i$ as follows:

\begin{equation}
\ioset_i^j(t) = \{x_i: \dist(\pos_i, \pfrs_j(t)) \le \cradius \}
\end{equation}

\noindent where the $\dist(\cdot, \cdot)$ function represents the minimum distance from a point to a set, and the set $\pfrs_j(t)$ is the set of states in the FRS $\frs_j(t)$ projected onto the states representing position $\pos_j$, and disregarding the non-position dimensions $\npos_j$:

\begin{equation}
\pfrs_j(t) = \{p: \exists \npos_j, (p, \npos_j) \in \frs_j(t)\}.
\end{equation}

