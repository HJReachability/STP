% !TEX root = STP_journal.tex
\section{Introduction}
Recently, there has been an immense surge of interest in the use of unmanned aerial systems (UASs) in urban environments. 
UASs have great potential in civil applications such as package delivery, aerial surveillance, disaster response, among many others \MCnote{(Removed 5 references)}. %\cite{Tice91, Debusk10, Amazon16, AUVSI16, BBC16}. 
Unlike previous uses of UASs for military purposes, civil applications will involve unmanned aerial vehicles (UAVs) flying in urban environments, potentially in close proximity of humans, other UAVs, and other important assets. 
As a result, government agencies such as the Federal Aviation Administration (FAA) and National Aeronautics and Space Administration (NASA) of the United States are urgently trying to develop new scalable ways to organize an airspace in which potentially thousands of UAVs can fly simultaneously in the same region \cite{FAA13, Kopardekar16}.

One essential problem that needs to be addressed is the safe multi-vehicle trajectory planning problem: how a group of vehicles in the same vicinity can reach their destinations while avoiding situations which are considered dangerous, such as collisions. In many previous studies that address this problem, specific control strategies for the vehicles are assumed, and approaches such as those involving induced velocity obstacles \cite{Fiorini98, Vandenberg08,Wu2012} and involving virtual potential fields to maintain collision \cite{Olfati-Saber2002, Chuang07} have been used. Other analyses of multi-vehicle systems include methods for real-time trajectory generation \cite{Feng-LiLian2002}, for path planning for vehicles with linear dynamics in the presence of obstacles with known motion \cite{Ahmadzadeh2009}, and for cooperative path planning via waypoints which do not account for vehicle dynamics \cite{Bellingham}. Other related work include those which consider only the collision avoidance problem without path planning. These results include those that assume the system has a linear model \cite{Beard2003, Schouwenaars2004, Stipanovic2007}, rely on a linearization of the system model \cite{Massink2001, Althoff2011}, assume a simple positional state space \cite{Lin2015}, and many others \cite{Lalish2008, Hoffmann2008, Chen2016}.

However, the capability to flexibly plan provably safe and dynamically feasible trajectories without making strong assumptions on the vehicles' dynamics and other vehicles' motion is essential for dense groups of UAVs to safely fly in each other's vicinity. In addition, in a practical setting, any trajectory or path planning scheme that also addresses collision avoidance must guarantee both goal satisfaction and safety of UAVs despite disturbances such as weather effects and communication faults \cite{Kopardekar16}. Furthermore, unexpected scenarios such as UAV malfunctions or even UAVs with malicious intent need to be accounted for.

The problem of trajectory planning and collision avoidance under disturbances in safety-critical systems has been studied using Hamilton-Jacobi (HJ) reachability analysis, which provides guarantees on goal satisfaction and safety of optimal system trajectories \cite{Barron90, Mitchell05, Bokanowski10, Bokanowski11, Margellos11, Fisac15}. Reachability-based methods are particular suitable in the context of UAVs because of the hard guarantees that are provided. In reachability analysis, one computes the reachable set, defined as the set of states from which the system can be driven to a target set. Many numerical tools are available for computing various definitions of reachable sets \cite{Sethian96, Osher02, Mitchell02, Mitchell07b}, and reachability analysis has been successfully used in applications involving systems with no more than two vehicles, such as pairwise collision avoidance \cite{Mitchell05}, automated in-flight refueling \cite{Ding08}, and many others \cite{Huang11, Bayen07}.

One of the main challenges of managing the next generation of airspace is the density of vehicles that needs to be accommodated \cite{Kopardekar16}. Such a large-scale system has a high-dimensional joint state space, making a direct application of dynamic programming-based approaches such as reachability analysis intractable. In particular, reachable set computations involve solving a HJ partial differential equation (PDE) or variational inequality (VI) on a grid representing a discretization of the state space, causing computational complexity to scale \textit{exponentially} with system dimension.

\subsection{Contributions and Outline}
In this paper, we propose the sequential trajectory planning (STP) method to tackle the multi-vehicle trajectory planning problem. 
Our approach is similar to the approaches of \cite{Erdmann1987, VandenBerg2005}, but provides hard guarantees on both the goal satisfaction and safety of all vehicles even in the presence of disturbances and a single intruder vehicle that could potentially be adversarial. 
In addition, our method scales only \textit{linearly} with the number of vehicles when there is no intruder, and \textit{quadratically} with the number of vehicles when there is a single intruder.
On a high level, the STP method assigns a strict priority ordering to the vehicles under consideration. Higher-priority vehicles plan their trajectories without taking into account the lower-priority vehicles. 
Lower-priority vehicles treat higher-priority vehicles as moving obstacles. 
Under this assumption, time-varying formulations of reachability \cite{Bokanowski11, Fisac15} can be used to obtain the optimal and provably safe trajectories for each vehicle, starting from the highest-priority vehicle. 
Thus, the curse of dimensionality is overcome for the multi-vehicle trajectory planning problem at the cost of a mild structural assumption. 

In a sense, the STP method reserves a portion of ``space-time'' in the airspace for each vehicle. The reserved space-time portion is recorded so that lower-priority vehicles can take it into account. Besides planning around the reserved space-time portions of higher-priority vehicles, no other communication between the vehicles is needed at execution time, even when disturbances and an intruder are present. \MCnote{Besides reducing computational complexity, a priority-based approach makes practical sense as priorities can be assigned in a first-come-first-serve basis by, for example, an air navigation service provider \cite{Kopardekar16}, based on flight requests from various companies and agencies sharing the airspace.}

\MCnote{Almost all computation is done \textit{offline} to produce a value function, corresponding to an appropriate optimal control problem or differential game, for each vehicle. 
The gradient of the value function can be stored in a look-up table, which is used \textit{online} to synthesize the optimal controller.
Controller synthesis amounts to evaluating an analytic expression, is the only online computation, and therefore can be done in real-time.}

In the absence of disturbances and intruders, and assuming each vehicle has perfect information about other vehicles' positions, each vehicle may plan and commit to an exact trajectory, with the reserved space-time being the collision set around the trajectory at every point in time. This basic concept of STP is formally presented in Section \ref{sec:basic}.

When the vehicles are affected by disturbances, exact trajectories cannot be known \textit{a priori}, and thus the basic STP algorithm cannot be directly applied. Fortunately, reachability analysis allows us to determine, at no additional computation cost, all possible states of each vehicle over time under the worst-case disturbance, given a control strategy. In addition, we can also determine suitable portions of space-time for each vehicle depending on the available information about the control strategies of higher-priority vehicles. STP under disturbances and three different assumptions on the information available about the control strategy of other vehicles is formally presented in Section \ref{sec:incomp}.

In scenarios where there could potentially be single, possibly adversarial intruder in the airspace, each vehicle needs extra space around other vehicles in order to be able to perform avoidance maneuvers. Assuming the intruder may be present for some maximum duration, we use use reachability analysis to determine precisely the amount of space-time needed for each vehicle to be able to avoid the intruder under the presence of disturbances, making our proposed method sufficiently robust to most practical scenarios. STP in the presence of a single intruder is formally presented in Section \ref{sec:intruder}.
