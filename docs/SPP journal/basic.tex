% !TEX root = SPP_journal.tex
\section{Basic SPP Solution\label{sec:basic}}
\MCnote{Algorithm is a lot clearer than writing. Change writing to match algorithm}In this section, we introduce the basic SPP algorithm assuming that there is not disturbance affecting the vehicles, and that each vehicle has the exact state information of higher priority vehicles. Although in practice, such assumptions do not hold, the basic SPP algorithm can serve as a useful approximation in certain situations. In addition, the description of the basic SPP will introducing the notation needed for describing the subsequent more realistic versions of SPP. 

SPP vehicles $\veh{i}, i=1,\ldots,N$, are each assigned a strict priority, with $\veh{j}$ having a higher priority than $\veh{i}$ if $j<i$. Without the presence of disturbances, we can write the dynamics the SPP vehicles as

\begin{equation}
\begin{aligned}
\dot\state_i &= \fdyn_i(\state_i, \ctrl_i), t \in [\edt, \sta] \\
\state_i(\edt) &= \state^0_i \\
\ctrl_i &\in \cset_i \\
i &= 1 \ldots, \N
\end{aligned}
\end{equation}

In SPP, each vehicle $\veh{i}$ plans the path to its target set $\targetset_i$ while avoiding static obstacles $\soset$ and the obstacles induced by higher priority vehicles $\veh{j}, j<i$; the lower priority vehicles $\veh{k}, k>i$ are ignored in the path planning process. From the perspective of $\veh{i}$, each of the higher priority vehicles $\veh{j}, j<i$ induces a time-varying obstacle denoted $\ioset_i^j(t)$. Therefore, each vehicle $\veh{i}$ must plan its path to $\targetset_i$ while avoiding the union of all the induced obstacles as well as the static obstacles. Let $\obsset_i(t)$ be the union of all the obstacles that $\veh{i}$ must avoid on its way to $\targetset_i$:

\begin{equation}
\label{eq:obsseti}
\obsset_i(t)  = \soset \cup \bigcup_{j=1}^{i-1} \ioset_i^j(t)
\end{equation}

With full state information of higher priority vehicles, the obstacle induced for $\veh{i}$ by $\veh{j}$ is simply

\begin{equation}
\label{eq:ioset}
\ioset_i^j(t) = \{\state_i \mid (\state_i, \state_j(t)) \in \dz_{ij}\}
\end{equation}

Since each higher priority vehicle $\veh{j}$ plans its path while ignoring $\veh{i}$, if $\veh{j}$ plans its path before $\veh{i}$ does, then in the absence of disturbances, $\state_j(t)$ is \textit{a priori} known, and therefore $\ioset_i^j(t)$ is a known, deterministic moving obstacle, and the path planning problem for $\veh{i}$ can be solved by first computing the BRS $\brs(t, \targetset_i, \obsset_i(t), \basicham)$. Since the control $\ctrl_i$ aims to reach $\targetset_i$, the Hamiltonian is given by

\begin{equation}
\label{eq:basicham}
\basicham(t, \state_i, p) = \min_{\ctrl_i} p \cdot \fdyn_i(\state_i, \ctrl_i)
\end{equation}

$\brs(t, \targetset_i, \obsset_i(t), \basicham)$ can be obtained by solving \eqref{eq:HJIVI_BRS} with $\targetset = \targetset_i$, $\obsset = \obsset_i$, and $\ham=\basicham$: 

\begin{equation}
\brs(t, \targetset_i, \obsset_i(t), \basicham) = \{\state_i \mid \valfunc(t, \state_i;  \targetset_i, \obsset_i(t), \basicham)\}
\end{equation}

The optimal control for reaching $\targetset_i$ while avoiding $\obsset_i(t)$ is then given by $\ctrl_i^*(\cdot, \targetset_i, \obsset_i(t), \basicham)$, defined in \eqref{eq:opt_ctrl}.

Notice that in the absence of disturbance, if $\state_j{\cdot}, j = 1,\ldots, i-1$, the trajectories of vehicles $\veh{j}, j<i$ are known, then $\veh{i}$ can plan its trajectory $\state_i(\cdot)$. In addition, since $\veh{1}$ has the highest priority, it only needs to take into account the static obstacles $\soset_1$ during path planning, and ignores all other vehicles. Therefore, we can always determine $\state_1{\cdot}$. By mathematical induction, we can obtain $\state_i{\cdot}~\forall i$, the state trajectory of all SPP vehicles. 

In summary, the basic SPP algorithm is given as follows:

\begin{alg}
\textbf{Basic SPP algorithm}: Given initial conditions $\state_i^0$, vehicle dynamics $\fdyn_i(t, \state_i, \ctrl_i)$, target set $\targetset_i$, and static obstacles $\soset_i, i = 1\ldots, \N$, for each $i$ in ascending order starting from $i=1$,
\begin{enumerate}
\item Determine the total obstacle set $\obsset_i(t)$, given in \eqref{eq:obsseti}. In the case $i=1$, $\obsset_i(t) = \soset_i ~ \forall t$.
\item Compute the BRS $\brs(t, \targetset_i, \obsset_i(t), \basicham)$ with the HJ VI given in  \eqref{eq:HJIVI_BRS}.
\item Determine the trajectory $\state_i(\cdot)$ using the initial condition $\state_i^0$ and vehicle dynamics $\fdyn(t, \state_i, \ctrl_i^*)$, where the optimal control  $\ctrl_i^*(\cdot, \targetset_i, \obsset_i(t), \basicham)$ is given by \eqref{eq:opt_ctrl}.
\item Given $\state_i(\cdot)$, compute the induced obstacles $\ioset_k^i(t)$ for each $k>i$. In the absense of disturbances, $\ioset_k^i(t)$ is given by \eqref{eq:ioset}.
\end{enumerate}
\end{alg}